<div data-controller="cookie-consent">
  <dialog data-cookie-consent-target="dialog"
          class="backdrop:bg-black/50 bg-transparent p-0 m-0 md:m-auto open:flex md:items-center md:justify-center fixed inset-0 w-full h-full max-w-none max-h-none md:w-[40vw] md:h-fit md:max-h-[90vh]">
    <div class="bg-gray-950 md:border md:border-gray-700 md:rounded-xl p-6 w-full h-full md:h-auto shadow-xl overflow-y-auto">
      <div class="flex items-center gap-3 mb-4">
        <svg class="w-6 h-6 text-gray-400 shrink-0" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 8.25v-1.5m0 1.5c-1.355 0-2.697.056-4.024.166C6.845 8.51 6 9.473 6 10.608v2.513m6-4.871c1.355 0 2.697.056 4.024.166C17.155 8.51 18 9.473 18 10.608v2.513M15 8.25v-1.5m-6 1.5v-1.5m12 9.75-1.5.75a3.354 3.354 0 0 1-3 0 3.354 3.354 0 0 0-3 0 3.354 3.354 0 0 1-3 0 3.354 3.354 0 0 0-3 0 3.354 3.354 0 0 1-3 0L3 16.5m15-3.379a48.474 48.474 0 0 0-6-.371c-2.032 0-4.034.126-6 .371m12 0c.39.049.777.102 1.163.16 1.07.16 1.837 1.094 1.837 2.175v5.169c0 .621-.504 1.125-1.125 1.125H4.125A1.125 1.125 0 0 1 3 20.625v-5.17c0-1.08.768-2.014 1.837-2.174A47.78 47.78 0 0 1 6 13.12M12.265 3.11a.375.375 0 1 1-.53 0L12 2.845l.265.265Zm-3 2a.375.375 0 1 1-.53 0L9 4.845l.265.265Zm6 0a.375.375 0 1 1-.53 0L15 4.845l.265.265Z"/>
        </svg>
        <h2 class="text-lg font-semibold text-white"><%= t("cookie_consent.title") %></h2>
      </div>

      <%# Initial view — accept/decline/customize %>
      <div data-cookie-consent-target="initialView">
        <p class="text-sm text-gray-400 mb-2"><%= t("cookie_consent.message") %></p>
        <p class="text-sm mb-6">
          <%= link_to t("cookie_consent.learn_more"), cookies_policy_path, class: "text-blue-400 hover:text-blue-300 underline" %>
        </p>

        <div class="flex flex-col sm:flex-row gap-3">
          <button data-action="click->cookie-consent#acceptAll"
                  class="flex-1 bg-white text-gray-950 font-semibold py-2 px-4 rounded hover:bg-gray-200 transition-colors text-sm">
            <%= t("cookie_consent.accept_all") %>
          </button>
          <button data-action="click->cookie-consent#declineAll"
                  class="flex-1 bg-gray-800 text-gray-300 font-semibold py-2 px-4 rounded hover:bg-gray-700 transition-colors text-sm">
            <%= t("cookie_consent.decline_all") %>
          </button>
          <button data-action="click->cookie-consent#customize"
                  class="flex-1 bg-gray-800 text-gray-300 font-semibold py-2 px-4 rounded hover:bg-gray-700 transition-colors text-sm">
            <%= t("cookie_consent.customize") %>
          </button>
        </div>
      </div>

      <%# Settings view — per-category toggles %>
      <div data-cookie-consent-target="settingsView" class="hidden">
        <div class="space-y-4 mb-6">
          <%# Essential cookies — always on %>
          <div class="p-4 bg-gray-900 rounded-lg border border-gray-800">
            <div class="flex items-center justify-between mb-2">
              <h3 class="text-sm font-medium text-white"><%= t("cookie_consent.essential.title") %></h3>
              <span class="text-xs px-2 py-0.5 rounded-full bg-green-500/20 text-green-400 font-medium"><%= t("cookie_consent.always_active") %></span>
            </div>
            <p class="text-xs text-gray-400"><%= t("cookie_consent.essential.description") %></p>
          </div>

          <%# Analytics cookies — toggle %>
          <div class="p-4 bg-gray-900 rounded-lg border border-gray-800">
            <div class="flex items-center justify-between mb-2">
              <h3 class="text-sm font-medium text-white"><%= t("cookie_consent.analytics.title") %></h3>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" data-cookie-consent-target="analyticsToggle" class="sr-only peer">
                <div class="w-9 h-5 bg-gray-700 rounded-full peer peer-checked:bg-blue-500 peer-focus:ring-2 peer-focus:ring-blue-800 after:content-[''] after:absolute after:top-0.5 after:start-0.5 after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-full"></div>
              </label>
            </div>
            <p class="text-xs text-gray-400"><%= t("cookie_consent.analytics.description") %></p>
          </div>
        </div>

        <div class="flex flex-col sm:flex-row gap-3">
          <button data-action="click->cookie-consent#savePreferences"
                  class="flex-1 bg-white text-gray-950 font-semibold py-2 px-4 rounded hover:bg-gray-200 transition-colors text-sm">
            <%= t("cookie_consent.save_preferences") %>
          </button>
        </div>
      </div>
    </div>
  </dialog>
</div>
