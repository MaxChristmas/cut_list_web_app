<% if @result %>
  <div data-controller="sheet-visualizer"
       data-sheet-visualizer-result-value="<%= (@original_result || @result).to_json %>"
       data-sheet-visualizer-edited-result-value="<%= (@edited_result || {}).to_json %>"
       data-sheet-visualizer-save-url-value="<%= save_layout_project_path(@project.token) %>"
       data-sheet-visualizer-reset-url-value="<%= reset_layout_project_path(@project.token) %>"
       data-sheet-visualizer-edit-label-value="<%= t('projects.index.edit_layout') %>"
       data-sheet-visualizer-editing-label-value="<%= t('projects.index.editing_layout') %>"
       data-sheet-visualizer-save-label-value="<%= t('projects.index.save_layout') %>"
       data-sheet-visualizer-reset-label-value="<%= t('projects.index.reset_layout') %>"
       data-sheet-visualizer-sheet-heading-template-value="<%= t('projects.index.sheet_heading', number: '%{number}', waste: '%{waste}') %>"
       data-sheet-visualizer-summary-template-value="<%= t('projects.index.summary', count: '%{count}', waste: '%{waste}') %>"
       data-sheet-visualizer-colors-label-value="<%= t('projects.index.colors') %>"
       data-sheet-visualizer-no-colors-label-value="<%= t('projects.index.no_colors') %>"
       data-sheet-visualizer-readonly-value="<%= @project&.template? || false %>"
       data-sheet-visualizer-grain-direction-value="<%= @project&.grain_direction || 'none' %>"
       data-sheet-visualizer-grain-image-value="<%= image_path('patterns/wood_grain_transparent.png') %>">

    <div class="flex flex-wrap gap-2 mb-4" data-controller="label-modal" data-label-modal-base-url-value="<%= export_labels_project_path(@project.token) %>">
      <%# Slot for JS-rendered Edit Layout / Save / Reset buttons %>
      <span data-sheet-visualizer-target="toolbar" class="contents"></span>

      <div class="flex-1"></div>

      <% if has_feature?(:print_labels) %>
        <button data-action="click->label-modal#open"
                class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A2 2 0 013 12V7a4 4 0 014-4z" />
          </svg>
          <%= t("labels.export_labels") %>
        </button>

        <%= render "projects/label_modal" %>
      <% end %>

      <% if has_feature?(:pdf_export) %>
        <%= link_to export_pdf_project_path(@project.token),
              class: "inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50",
              data: { "sheet-visualizer-target": "pdfLink" } do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 10v6m0 0l-3-3m3 3l3-3M3 17v3a2 2 0 002 2h14a2 2 0 002-2v-3" />
          </svg>
          <%= t("projects.index.export_pdf") %>
        <% end %>
      <% end %>
    </div>

    <div data-sheet-visualizer-target="canvas"></div>
  </div>

  <details class="mt-6">
    <summary class="text-sm text-gray-500 cursor-pointer hover:text-gray-700"><%= t("projects.index.raw_json") %></summary>
    <pre class="bg-gray-100 rounded p-4 overflow-x-auto text-sm mt-2"><%= JSON.pretty_generate(@result) %></pre>
  </details>
<% else %>
  <div class="flex items-center justify-center h-full text-gray-400">
    <p class="text-lg bg-stone-100 p-4 border-0 rounded-xl"><%= t("projects.index.empty_state") %></p>
  </div>
<% end %>
